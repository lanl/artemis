

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Running artemis &mdash; artemis  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/artemis_style.css?v=569d4c90" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script src="../_static/collapse.js?v=5227af5a"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Physics Modules" href="physics.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            artemis
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="bcs.html">Boundary Conditions</a></li>
<li class="toctree-l1"><a class="reference internal" href="parameters.html">Input Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="pgen.html">Problem Generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="physics.html">Physics Modules</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Running <strong>artemis</strong></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#create-the-input-file">Create the input file</a></li>
<li class="toctree-l2"><a class="reference internal" href="#run-code">Run <strong>artemis</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#return-codes">Return codes</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">artemis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Running <strong>artemis</strong></li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/src/running.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="running-code">
<span id="running"></span><h1>Running <strong>artemis</strong><a class="headerlink" href="#running-code" title="Link to this heading"></a></h1>
<section id="create-the-input-file">
<h2>Create the input file<a class="headerlink" href="#create-the-input-file" title="Link to this heading"></a></h2>
<p>All of the configuration options for an <strong>artemis</strong> simulation are contained in an input file called <code class="docutils literal notranslate"><span class="pre">input.par</span></code> for this example.
The input file contains all the necessary instructions for creating and executing the simulation.
The style of the input file follows that of Parthenon input files.
Input “blocks” (or “nodes”) are denoted with <code class="docutils literal notranslate"><span class="pre">&lt;...&gt;</span></code>.
Inside the blocks are <code class="docutils literal notranslate"><span class="pre">key</span> <span class="pre">=</span> <span class="pre">value</span></code> pairs that specify each parameter under that particular block.
The values can be integers, floats, strings, or even comma separated vectors.</p>
<p>At the very top of the input file, there is an <code class="docutils literal notranslate"><span class="pre">&lt;artemis&gt;</span></code> block that controls some global parameters such as the coordinate system and problem definition.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">artemis</span><span class="o">&gt;</span>
<span class="n">coordinates</span> <span class="o">=</span> <span class="n">cylindrical</span>   <span class="c1"># cartesian, cylindrical, spherical, axisymmetric</span>
<span class="n">problem</span> <span class="o">=</span> <span class="n">disk</span>               <span class="c1"># name of the problem generator</span>
</pre></div>
</div>
<p>Next, the <code class="docutils literal notranslate"><span class="pre">&lt;parthenon/job&gt;</span></code> block specifies the base name of the simulation outputs.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">parthenon</span><span class="o">/</span><span class="n">job</span><span class="o">&gt;</span>
<span class="n">problem_id</span> <span class="o">=</span> <span class="n">name</span>       <span class="c1"># name of output files</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">&lt;parthenon/time&gt;</span></code> block controls the evolution of the simulation, including safeguards against crashing.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">parthenon</span><span class="o">/</span><span class="n">time</span><span class="o">&gt;</span>
<span class="n">nlim</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>           <span class="c1"># Maximum number of cycles; -1 indicates unlimited cycles</span>
<span class="n">tlim</span> <span class="o">=</span> <span class="mf">62.8</span>         <span class="c1"># end time</span>
<span class="n">integrator</span> <span class="o">=</span> <span class="n">rk2</span>    <span class="c1"># rk1, vl2, rk2, rk3</span>
<span class="n">dt_min</span> <span class="o">=</span> <span class="mf">1e-10</span>      <span class="c1"># halt execution if dt &lt; dt_min</span>
<span class="n">dt_max</span> <span class="o">=</span> <span class="mf">1.0</span>        <span class="c1"># halt execution if dt &gt; dt_max</span>
</pre></div>
</div>
<p>The parameters <code class="docutils literal notranslate"><span class="pre">dt_min</span></code> and <code class="docutils literal notranslate"><span class="pre">dt_max</span></code> will halt the simulation if the time step falls outside their range.</p>
<p>Next, the output blocks control when and what <strong>artemis</strong> writes to disk as the simulation is running.
Typically, there are three types of outputs specified here, history, hdf5 snapshots, and hdf5 restart files.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">parthenon</span><span class="o">/</span><span class="n">output1</span><span class="o">&gt;</span>
<span class="n">variables</span> <span class="o">=</span> <span class="n">gas</span><span class="o">.</span><span class="n">prim</span><span class="o">.</span><span class="n">density</span><span class="p">,</span>  <span class="o">&amp;</span>
            <span class="n">gas</span><span class="o">.</span><span class="n">prim</span><span class="o">.</span><span class="n">velocity</span><span class="p">,</span> <span class="o">&amp;</span>
            <span class="n">gas</span><span class="o">.</span><span class="n">prim</span><span class="o">.</span><span class="n">pressure</span>
<span class="n">file_type</span> <span class="o">=</span> <span class="n">hdf5</span>  <span class="c1"># HDF5 data dump</span>
<span class="n">dt</span>        <span class="o">=</span> <span class="mf">1.0</span>   <span class="c1"># time increment between outputs</span>

<span class="o">&lt;</span><span class="n">parthenon</span><span class="o">/</span><span class="n">output2</span><span class="o">&gt;</span>
<span class="n">file_type</span> <span class="o">=</span> <span class="n">rst</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">6.28</span>        <span class="c1"># time between restarts</span>

<span class="o">&lt;</span><span class="n">parthenon</span><span class="o">/</span><span class="n">output3</span><span class="o">&gt;</span>
<span class="n">file_type</span> <span class="o">=</span> <span class="n">hst</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.2</span>         <span class="c1"># time between history dumps</span>
</pre></div>
</div>
<p>The next blocks define the simulation mesh dimensions, boundary conditions, and meshblock size.
This example sets up a 2D cylindrical mesh that spans the full <span class="math notranslate nohighlight">\(2 \pi\)</span> in azimuth.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">parthenon</span><span class="o">/</span><span class="n">mesh</span><span class="o">&gt;</span>
<span class="n">nghost</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">refinement</span> <span class="o">=</span> <span class="n">static</span>          <span class="c1"># none, static, adaptive</span>
<span class="n">numlevel</span> <span class="o">=</span> <span class="mi">3</span>                 <span class="c1"># the maximum number of refinement levels</span>

<span class="n">nx1</span>    <span class="o">=</span> <span class="mi">256</span>                 <span class="c1"># Number of zones in X1-direction</span>
<span class="n">x1min</span>  <span class="o">=</span> <span class="mf">0.3</span>                 <span class="c1"># minimum value of X1</span>
<span class="n">x1max</span>  <span class="o">=</span> <span class="mf">3.0</span>                 <span class="c1"># maximum value of X1</span>
<span class="n">ix1_bc</span> <span class="o">=</span> <span class="n">ic</span>                  <span class="c1"># Inner-X1 boundary condition flag</span>
<span class="n">ox1_bc</span> <span class="o">=</span> <span class="n">ic</span>                  <span class="c1"># Outer-X1 boundary condition flag</span>

<span class="n">nx2</span>    <span class="o">=</span> <span class="mi">1024</span>                <span class="c1"># Number of zones in X2-direction</span>
<span class="n">x2min</span>  <span class="o">=</span> <span class="o">-</span><span class="mf">3.141592653589793</span>  <span class="c1"># minimum value of X2</span>
<span class="n">x2max</span>  <span class="o">=</span> <span class="mf">3.141592653589793</span>   <span class="c1"># maximum value of X2</span>
<span class="n">ix2_bc</span> <span class="o">=</span> <span class="n">periodic</span>            <span class="c1"># Inner-X2 boundary condition flag</span>
<span class="n">ox2_bc</span> <span class="o">=</span> <span class="n">periodic</span>            <span class="c1"># Outer-X2 boundary condition flag</span>

<span class="n">nx3</span>    <span class="o">=</span> <span class="mi">1</span>                   <span class="c1"># Number of zones in X3-direction</span>
<span class="n">x3min</span>  <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span>                <span class="c1"># minimum value of X3</span>
<span class="n">x3max</span>  <span class="o">=</span> <span class="mf">0.5</span>                 <span class="c1"># maximum value of X3</span>
<span class="n">ix3_bc</span> <span class="o">=</span> <span class="n">periodic</span>            <span class="c1"># Inner-X3 boundary condition flag</span>
<span class="n">ox3_bc</span> <span class="o">=</span> <span class="n">periodic</span>            <span class="c1"># Outer-X3 boundary condition flag</span>

<span class="o">&lt;</span><span class="n">parthenon</span><span class="o">/</span><span class="n">meshblock</span><span class="o">&gt;</span>
<span class="n">nx1</span> <span class="o">=</span> <span class="mi">32</span>
<span class="n">nx2</span> <span class="o">=</span> <span class="mi">32</span>
<span class="n">nx3</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
<p><a class="reference internal" href="bcs.html#bc"><span class="std std-ref">Boundary Conditions</span></a> describes all the possible boundary conditions.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">refinement</span></code> parameter in the <code class="docutils literal notranslate"><span class="pre">&lt;parthenon/mesh&gt;</span></code> block  controls how mesh refinement is handled.
If <code class="docutils literal notranslate"><span class="pre">refinement</span> <span class="pre">=</span> <span class="pre">none</span></code>, no refinement occurs.
Setting <code class="docutils literal notranslate"><span class="pre">refinement</span> <span class="pre">=</span> <span class="pre">adaptive</span></code> activates adaptive mesh refinement.
The physics packages can control when and where to refine and de-refine the mesh.
See <a class="reference internal" href="physics.html#physics"><span class="std std-ref">Physics Modules</span></a> for a description of each package.
Lastly, if <cite>refinement = static</cite>, the input file controls where the mesh is refined.
There are additional input blocks specify where this refinement is located.
For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">parthenon</span><span class="o">/</span><span class="n">static_refinement1</span><span class="o">&gt;</span>
<span class="n">level</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">x1min</span> <span class="o">=</span> <span class="mf">0.9</span>
<span class="n">x1max</span> <span class="o">=</span> <span class="mf">1.1</span>
<span class="n">x2min</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span>
<span class="n">x2max</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">x3min</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
<span class="n">x3max</span> <span class="o">=</span> <span class="mf">1.0</span>
</pre></div>
</div>
<p>Up until now, the input file has been mainly specifying parameters for Parthenon.
The following blocks deal with <strong>artemis</strong> specific parameters.
First, all of the active physics packages are listed.
The following example activates the <code class="docutils literal notranslate"><span class="pre">gas</span></code>, <code class="docutils literal notranslate"><span class="pre">gravity</span></code>, <code class="docutils literal notranslate"><span class="pre">viscosity</span></code>, and <code class="docutils literal notranslate"><span class="pre">rotating_frame</span></code> packages.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">physics</span><span class="o">&gt;</span>
<span class="n">gas</span> <span class="o">=</span> <span class="n">true</span>
<span class="n">gravity</span> <span class="o">=</span> <span class="n">true</span>
<span class="n">viscosity</span> <span class="o">=</span> <span class="n">true</span>
<span class="n">rotating_frame</span> <span class="o">=</span> <span class="n">true</span>
</pre></div>
</div>
<p>Each active physics package will have an associated input block specifying its parameters.
Following the example, simple <code class="docutils literal notranslate"><span class="pre">&lt;gas&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;gas/viscosity&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;gravity&gt;</span></code>, and <code class="docutils literal notranslate"><span class="pre">&lt;rotating_frame&gt;</span></code> blocks are added.
For more details see the <a class="reference internal" href="physics.html#physics"><span class="std std-ref">Physics Modules</span></a> and <a class="reference internal" href="parameters.html#parameters"><span class="std std-ref">Input Parameters</span></a> sections</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">gas</span><span class="o">&gt;</span>
<span class="n">cfl</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">eos</span> <span class="o">=</span> <span class="n">ideal</span>
<span class="n">gamma</span> <span class="o">=</span> <span class="mf">1.4</span>
<span class="n">riemann</span> <span class="o">=</span> <span class="n">hllc</span>
<span class="n">reconstruct</span> <span class="o">=</span> <span class="n">plm</span>

<span class="o">&lt;</span><span class="n">gas</span><span class="o">/</span><span class="n">viscosity</span><span class="o">&gt;</span>
<span class="nb">type</span> <span class="o">=</span> <span class="n">alpha</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">1e-3</span>

<span class="o">&lt;</span><span class="n">gravity</span><span class="o">&gt;</span>
<span class="n">gm</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="o">&lt;</span><span class="n">gravity</span><span class="o">/</span><span class="n">binary</span><span class="o">&gt;</span>
<span class="n">q</span> <span class="o">=</span> <span class="mf">1e-3</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">sft2</span> <span class="o">=</span> <span class="mf">.06</span>

<span class="o">&lt;</span><span class="n">rotating_frame</span><span class="o">&gt;</span>
<span class="n">omega</span> <span class="o">=</span> <span class="mf">1.0</span>
</pre></div>
</div>
<p>Finally, there is a <code class="docutils literal notranslate"><span class="pre">&lt;problem&gt;</span></code> block that contains the parameters controlling the problem initial conditions.
See <a class="reference internal" href="pgen.html#pgen"><span class="std std-ref">Problem Generators</span></a> for a list of the possible <code class="docutils literal notranslate"><span class="pre">&lt;problem&gt;</span></code> blocks,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">problem</span><span class="o">&gt;</span>
<span class="n">h0</span> <span class="o">=</span> <span class="mf">.05</span>
<span class="n">rho0</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">dslope</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span>
<span class="n">flare</span> <span class="o">=</span> <span class="mf">0.0</span>
</pre></div>
</div>
</section>
<section id="run-code">
<h2>Run <strong>artemis</strong><a class="headerlink" href="#run-code" title="Link to this heading"></a></h2>
<p><strong>artemis</strong> is an MPI + GPU executable.
The exact command to launch it depends on the system it is run on.
This example will assume a SLURM-like cluster.</p>
<p>To launch a fresh <strong>artemis</strong> simulation on <code class="docutils literal notranslate"><span class="pre">$NPROCS</span></code> CPUs with <code class="docutils literal notranslate"><span class="pre">srun</span></code>,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>srun -n $NPROCS artemis -i input.par
</pre></div>
</div>
<p>To restart a previous run, use the <code class="docutils literal notranslate"><span class="pre">-r</span></code> argument</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>srun -n $NPROCS artemis -r name.final.rst
</pre></div>
</div>
<p>A modified input file can optionally still be passed with the <code class="docutils literal notranslate"><span class="pre">-i</span></code> argument.</p>
<p>When launching <strong>artemis</strong> on GPUs with <code class="docutils literal notranslate"><span class="pre">srun</span></code>, the application passed to <code class="docutils literal notranslate"><span class="pre">srun</span></code> should not be <strong>artemis</strong>, but instead a script that
determines how to bind the CPU cores to the available GPUs.
One such script that comes with <code class="docutils literal notranslate"><span class="pre">Kokkos</span></code> is <code class="docutils literal notranslate"><span class="pre">hpcbind</span></code>.
Assuming the <strong>artemis</strong> source code lives in <code class="docutils literal notranslate"><span class="pre">$ARTEMIS_HOME</span></code>, the following will launch <strong>artemis</strong> on the available number of GPUs</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>srun -n $NPROCS $ARTEMIS_HOME/external/parthenon/external/Kokkos/bin/hpcbind -- artemis -i input.par
</pre></div>
</div>
</section>
<section id="return-codes">
<h2>Return codes<a class="headerlink" href="#return-codes" title="Link to this heading"></a></h2>
<p>When using batch submissions, it is possible to set up a self-restarting job.
The easiest way to do this is to take advantage of SLURM interrupt signals and the <strong>artemis</strong> return code.
<strong>artemis</strong></p>
<p>An example CPU batch submission script, <code class="docutils literal notranslate"><span class="pre">run.sh</span></code>, would look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/bash
#SBATCH -J name
#SBATCH -N 1
#SBATCH --ntasks-per-node=128
#SBATCH -t 16:00:00

set -o pipefail

if [ ! -f name.final.rst ]; then
  echo &quot;Starting fresh&quot;
  srun -n $SLURM_NPROCS artemis -i input.par -t 15:50:00
else
  echo &quot;Restarting&quot;
  srun -n $SLURM_NPROCS artemis -r name.final.rst -t 15:50:00
fi

EXITCODE=$?

set +o pipefail

if [[ $EXITCODE -eq 2 ]]; then
 echo &quot;Resubmitting&quot;
 sbatch run.sh
fi
</pre></div>
</div>
<p>This stops <strong>artemis</strong> 10 minutes before the job ends.
If the simulation has completed by then, <strong>artemis</strong> will return <code class="docutils literal notranslate"><span class="pre">0</span></code>.
Instead if it hasn’t reached its end time yet, it will return <code class="docutils literal notranslate"><span class="pre">2</span></code>.
And if the simulation crashed for some reason, it will return <code class="docutils literal notranslate"><span class="pre">1</span></code>.
If the return code is <code class="docutils literal notranslate"><span class="pre">2</span></code>, the batch script will resubmit itself.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="physics.html" class="btn btn-neutral float-left" title="Physics Modules" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 
 (C) (or copyright) 2024. Triad National Security, LLC. All rights reserved.
.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>